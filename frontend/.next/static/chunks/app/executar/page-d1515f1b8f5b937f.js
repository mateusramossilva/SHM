(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[608],{2383:()=>{},3175:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),r=a(2115),l=a(4246),o=a(5125);let n="https://SEU-BACKEND.up.railway.app";function i(){let[e,t]=(0,r.useState)(!1),[a,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)("IDLE"),[x,m]=(0,r.useState)(!1),[p,u]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null),[g,f]=(0,r.useState)([]),[v,j]=(0,r.useState)(0),[N,w]=(0,r.useState)([]),[k,y]=(0,r.useState)([]),[C,E]=(0,r.useState)({open:!1,title:"",message:"",type:"error",onConfirm:null}),D=(0,r.useRef)(!1),S=(0,r.useRef)(!1),F=(0,r.useRef)(null),A=(0,r.useRef)(null),[O,P]=(0,r.useState)({emissao:"",registro:"",vencimento:"",previsao:""}),[_,L]=(0,r.useState)({omie:null,doctor:null});(0,r.useEffect)(()=>{t(!0)},[]);let R={emissao:"Data em que o documento original foi emitido pelo prestador.",registro:"Data de entrada do t\xedtulo no sistema financeiro.",vencimento:"Data limite para pagamento sem incid\xeancia de juros.",previsao:"Data planejada para o desembolso (fluxo de caixa)."},I=()=>E({...C,open:!1}),T=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";return E({open:!0,title:e,message:t,type:a,onConfirm:null})},U=async()=>{d("SYNCING"),S.current=!1,D.current=!1;try{let a=await o.A.post("".concat(n,"/automation/preparar-dados"),{contas:g});y(a.data.ignorados);let s=a.data.prontos;for(let a=v;a<s.length;a++){if(S.current)return void d("CANCELLED");for(;D.current&&!S.current;)await new Promise(e=>setTimeout(e,500));let r=s[a];a>0&&await new Promise(e=>setTimeout(e,1200));try{let e=await o.A.post("".concat(n,"/automation/incluir-individual"),r);w(t=>[...t,{...r,status:"sucesso",idOmie:e.data.codigo_lancamento_omie}])}catch(s){var e,t;let a=(null==(t=s.response)||null==(e=t.data)?void 0:e.message)||s.message;w(e=>[...e,{...r,status:"erro",msg:a}])}j(a+1)}d("REPORT")}catch(e){T("Erro de Conex\xe3o","N\xe3o foi poss\xedvel sincronizar. Verifique o servidor.","error"),d("IDLE")}},B=async()=>{if(!O.emissao||!O.registro||!O.vencimento||!O.previsao)return void T("Datas Incompletas","Todas as 4 datas (Emiss\xe3o, Registro, Vencimento, Previs\xe3o) s\xe3o obrigat\xf3rias.","error");if(O.registro<O.emissao)return void T("Inconsist\xeancia Cronol\xf3gica","A Data de Registro n\xe3o pode ser anterior \xe0 Data de Emiss\xe3o.","error");i(!0);try{let e=new FormData;e.append("omie",_.omie),e.append("doctor",_.doctor),e.append("datas",JSON.stringify(O));let t=await fetch("".concat(n,"/automation/processar"),{method:"POST",body:e});if(!t.ok){let e=await t.json();throw Error(e.message||"Erro no processamento")}let a=await t.blob();b(a);let s=new FileReader;s.onload=e=>{var t;let a=new Uint8Array(null==(t=e.target)?void 0:t.result),s=l.LF(a,{type:"array"}),r=s.Sheets[s.SheetNames[0]],o=l.Wp.sheet_to_json(r,{header:1}),n=[];for(let e=5;e<o.length;e++){let t=o[e];t&&t[2]&&n.push({cod_cliente:t[2],medico_nome:t[3],valor:t[5],categoria:t[7],banco:t[4],data_vencimento:O.vencimento})}f(n),u(!0),i(!1)},s.readAsArrayBuffer(a)}catch(e){i(!1),T("Erro no Processamento",e.message,"error")}};return e?(0,s.jsxs)("div",{className:"max-w-6xl mx-auto py-12 px-8 font-sans text-slate-900 bg-[#F9FBFF] min-h-screen relative",children:[C.open&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm animate-in fade-in duration-200",children:(0,s.jsxs)("div",{className:"bg-white rounded-[2rem] shadow-2xl max-w-md w-full p-8 border border-slate-100 animate-in zoom-in-95 duration-200",children:[(0,s.jsxs)("div",{className:"mb-6",children:["error"===C.type&&(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center text-2xl",children:"\uD83D\uDEA8"}),"success"===C.type&&(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-2xl",children:"✅"}),"confirm"===C.type&&(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-2xl",children:"⚠️"})]}),(0,s.jsx)("h3",{className:"text-lg font-black uppercase tracking-tight mb-2 ".concat("error"===C.type?"text-red-600":"success"===C.type?"text-emerald-600":"text-slate-800"),children:C.title}),(0,s.jsx)("p",{className:"text-sm font-bold text-slate-500 mb-8 leading-relaxed",children:C.message}),(0,s.jsx)("div",{className:"flex gap-3",children:"confirm"===C.type?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:I,className:"flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-slate-200 transition-all",children:"Cancelar"}),(0,s.jsx)("button",{onClick:()=>{C.onConfirm&&C.onConfirm(),I()},className:"flex-1 py-4 bg-red-500 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-red-600 transition-all shadow-lg shadow-red-100",children:"Confirmar"})]}):(0,s.jsx)("button",{onClick:I,className:"w-full py-4 bg-slate-900 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest hover:bg-black transition-all shadow-lg",children:"Entendido"})})]})}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-12",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-black uppercase italic tracking-tighter text-slate-800",children:["AUTOMA\xc7\xc3O ",(0,s.jsx)("span",{className:"text-[#0052FF]",children:"SHM"})]}),(0,s.jsx)("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1",children:"Backoffice Core v5.0"})]}),"IDLE"!==c&&(0,s.jsx)("button",{onClick:()=>{S.current=!1,D.current=!1,L({omie:null,doctor:null}),P({emissao:"",registro:"",vencimento:"",previsao:""}),m(!1),u(!1),d("IDLE"),j(0),w([]),y([])},className:"px-4 py-2 bg-white border border-slate-200 rounded-lg text-[10px] font-black text-slate-400 hover:text-red-500 uppercase transition-all",children:"↺ Reiniciar Sistema"})]}),"IDLE"===c&&(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-8",children:[(0,s.jsxs)("div",{className:"col-span-12 lg:col-span-7 space-y-4",children:[(0,s.jsxs)("div",{onClick:()=>{var e;return!p&&(null==(e=F.current)?void 0:e.click())},className:"p-8 border-2 rounded-2xl transition-all cursor-pointer ".concat(_.omie?"border-emerald-500 bg-emerald-50/10":"border-slate-100 bg-white hover:border-[#0052FF]"),children:[(0,s.jsx)("input",{type:"file",ref:F,className:"hidden",onChange:e=>{var t;return L({..._,omie:(null==(t=e.target.files)?void 0:t[0])||null})}}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-bold uppercase",children:"1. Template Omie"}),(0,s.jsx)("p",{className:"text-[11px] text-slate-400 mt-1",children:_.omie?_.omie.name:"V\xednculo obrigat\xf3rio"})]}),_.omie&&(0,s.jsx)("div",{className:"bg-emerald-500 text-white text-[10px] font-black px-4 py-2 rounded-lg text-white",children:"OK"})]})]}),_.omie&&(0,s.jsxs)("div",{className:"p-8 border-2 rounded-2xl transition-all ".concat(x?"border-emerald-500 bg-white":"border-slate-100 bg-slate-50"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h3",{className:"text-sm font-bold uppercase",children:"2. Datas de Lan\xe7amento"}),x&&(0,s.jsx)("button",{onClick:()=>m(!1),className:"text-[9px] font-black text-[#0052FF] uppercase underline",children:"Editar"})]}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-3",children:Object.keys(O).map(e=>(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsxs)("label",{className:"text-[8px] font-black text-slate-400 uppercase ml-1 flex items-center gap-1 cursor-help",children:[e," ",(0,s.jsx)("span",{className:"text-blue-500 text-[10px] italic",children:"?"}),(0,s.jsx)("span",{className:"absolute bottom-full left-0 mb-2 w-40 p-2 bg-slate-800 text-white text-[9px] rounded-lg opacity-0 group-hover:opacity-100 transition-opacity z-10 pointer-events-none",children:R[e]})]}),(0,s.jsx)("input",{type:"date",disabled:x,value:O[e],className:"w-full p-2.5 bg-white border border-slate-200 rounded-lg text-[10px] font-bold outline-none disabled:opacity-40",onChange:t=>P({...O,[e]:t.target.value})})]},e))}),!x&&(0,s.jsx)("button",{onClick:()=>m(!0),className:"mt-6 w-full py-3 bg-slate-800 text-white rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-black transition-all",children:"Validar Calend\xe1rio"})]}),(0,s.jsxs)("div",{onClick:()=>{var e;return x&&!p&&(null==(e=A.current)?void 0:e.click())},className:"p-8 border-2 rounded-2xl transition-all cursor-pointer ".concat(x?_.doctor?"border-emerald-500 bg-emerald-50/10":"border-slate-100 bg-white hover:border-[#0052FF]":"opacity-20 pointer-events-none"),children:[(0,s.jsx)("input",{type:"file",ref:A,className:"hidden",onChange:e=>{var t;return L({..._,doctor:(null==(t=e.target.files)?void 0:t[0])||null})}}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-bold uppercase",children:"3. Relat\xf3rio Doctor ID"}),(0,s.jsx)("p",{className:"text-[11px] text-slate-400 mt-1",children:_.doctor?_.doctor.name:"Fonte de dados"})]}),_.doctor&&(0,s.jsx)("div",{className:"bg-emerald-500 text-white text-[10px] font-black px-4 py-2 rounded-lg text-white",children:"OK"})]})]})]}),(0,s.jsx)("div",{className:"col-span-12 lg:col-span-5",children:(0,s.jsxs)("div",{className:"bg-white border-2 border-slate-100 rounded-[3rem] p-10 h-full flex flex-col justify-between shadow-sm",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h4",{className:"text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] mb-12",children:"Capacidade de Processamento"}),p?(0,s.jsxs)("div",{className:"animate-in zoom-in duration-500",children:[(0,s.jsx)("div",{className:"text-7xl font-black text-[#0052FF] tracking-tighter mb-2",children:g.length}),(0,s.jsx)("span",{className:"text-[12px] font-black text-slate-800 uppercase tracking-widest",children:"Registros Detectados"}),(0,s.jsx)("div",{className:"mt-6 h-1 w-20 bg-[#0052FF] mx-auto rounded-full"})]}):(0,s.jsxs)("div",{className:"py-10 grayscale opacity-40",children:[(0,s.jsx)("div",{className:"text-7xl font-black text-slate-200 tracking-tighter mb-2",children:"00"}),(0,s.jsx)("p",{className:"text-[10px] font-bold text-slate-300 uppercase italic",children:"Aguardando Inje\xe7\xe3o"})]})]}),(0,s.jsx)("div",{className:"space-y-4",children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{let e=window.URL.createObjectURL(h),t=document.createElement("a");t.href=e,t.download="shm_final.xlsx",t.click()},className:"w-full py-5 bg-slate-800 text-white rounded-[2rem] font-black uppercase text-[10px] tracking-widest hover:bg-black transition-all",children:"Baixar Excel Final"}),(0,s.jsx)("button",{onClick:U,className:"w-full py-5 border-2 border-[#0052FF] text-[#0052FF] rounded-[2rem] font-black uppercase text-[10px] tracking-widest hover:bg-[#0052FF] hover:text-white transition-all shadow-lg shadow-blue-50",children:"Sincronizar com Omie"})]}):(0,s.jsx)("button",{onClick:B,disabled:!_.doctor||a,className:"w-full py-7 bg-[#0052FF] text-white rounded-[2rem] font-black uppercase text-xs tracking-widest shadow-2xl shadow-blue-100 disabled:bg-slate-100 transition-all",children:a?"Motor em Execu\xe7\xe3o...":"Processar Lote"})})]})})]}),"IDLE"!==c&&(0,s.jsxs)("div",{className:"mt-4 border-2 border-slate-100 rounded-[2.5rem] bg-white overflow-hidden shadow-2xl animate-in fade-in slide-in-from-bottom-8 duration-700",children:[(0,s.jsxs)("div",{className:"bg-slate-50 border-b border-slate-100 px-10 py-8 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-sm font-black text-slate-800 uppercase italic",children:"Monitor de Transmiss\xe3o Omie"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[("SYNCING"===c||"PAUSED"===c)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{D.current=!D.current,d(D.current?"PAUSED":"SYNCING")},className:"px-6 py-3 rounded-xl text-[10px] font-black uppercase transition-all shadow-md ".concat("PAUSED"===c?"bg-amber-500 text-white":"bg-white border text-slate-600"),children:"PAUSED"===c?"▶ Continuar":"⏸ Pausar"}),(0,s.jsx)("button",{onClick:()=>E({open:!0,title:"Cancelar Sincroniza\xe7\xe3o?",message:"Isso ir\xe1 interromper o processo. As contas j\xe1 enviadas permanecer\xe3o na Omie.",type:"confirm",onConfirm:()=>{S.current=!0}}),className:"px-6 py-3 bg-red-50 text-red-600 border border-red-100 rounded-xl text-[10px] font-black uppercase hover:bg-red-600 hover:text-white transition-all",children:"⏹ Cancelar"})]}),("REPORT"===c||"CANCELLED"===c)&&(0,s.jsx)("button",{onClick:()=>{let e=new Date().toLocaleDateString("pt-BR").replace(/\//g,"-"),t=[...N.map(e=>({CPF:e.cpf,STATUS:e.status.toUpperCase(),DETALHE:e.idOmie||e.msg})),...k.map(e=>({CPF:e.cpf,STATUS:"N\xc3O ENCONTRADO NA OMIE"}))],a=l.Wp.json_to_sheet(t),s=l.Wp.book_new();l.Wp.book_append_sheet(s,a,"Logs_Sincronia"),l._h(s,"Relatorio_Omie_".concat(e,".xlsx"))},className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl text-[10px] font-black uppercase tracking-widest transition-all shadow-md shadow-emerald-100",children:"\uD83D\uDCBE Baixar Relat\xf3rio"})]})]}),(0,s.jsxs)("div",{className:"p-10",children:[("SYNCING"===c||"PAUSED"===c)&&(0,s.jsxs)("div",{className:"mb-10 text-center",children:[(0,s.jsx)("span",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:"PAUSED"===c?"Opera\xe7\xe3o Pausada":"Processando Lote Financeiro"}),(0,s.jsxs)("div",{className:"text-4xl font-black text-[#0052FF] mt-2 mb-4",children:[v," / ",g.length]}),(0,s.jsx)("div",{className:"max-w-md mx-auto bg-slate-100 h-1.5 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 ".concat("PAUSED"===c?"bg-amber-400":"bg-[#0052FF]"),style:{width:"".concat(v/(g.length||1)*100,"%")}})})]}),"CANCELLED"===c&&(0,s.jsx)("div",{className:"mb-10 p-4 bg-red-50 border-2 border-red-100 rounded-2xl text-red-700 text-xs font-black uppercase text-center",children:"⚠ Processo cancelado."}),(0,s.jsx)("div",{className:"grid grid-cols-4 gap-6 h-[480px]",children:[{title:"✅ Sucessos",color:"emerald",data:N.filter(e=>"sucesso"===e.status)},{title:"⛔ Inativos",color:"red",data:N.filter(e=>"erro"===e.status&&e.msg.toLowerCase().includes("inativo"))},{title:"⚠️ N\xe3o Encontrados",color:"amber",data:k},{title:"❌ Erros API",color:"slate",data:N.filter(e=>"erro"===e.status&&!e.msg.toLowerCase().includes("inativo"))}].map((e,t)=>(0,s.jsxs)("div",{className:"flex flex-col border border-slate-100 rounded-3xl bg-slate-50/40 overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 bg-white border-b border-slate-100 flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-[10px] font-black uppercase text-".concat(e.color,"-600 tracking-widest"),children:e.title}),(0,s.jsx)("span",{className:"text-[10px] font-bold text-slate-400",children:e.data.length})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:e.data.map((e,t)=>(0,s.jsxs)("div",{className:"bg-white p-3 border border-slate-100 rounded-xl shadow-sm hover:border-blue-200 transition-all",children:[(0,s.jsx)("div",{className:"text-[11px] font-black text-slate-700",children:e.cpf||"LOG_ERROR"}),e.idOmie&&(0,s.jsxs)("div",{className:"text-[8px] font-black text-emerald-500 mt-1 uppercase",children:["API_ID: ",e.idOmie]}),e.msg&&(0,s.jsx)("div",{className:"text-[8px] text-slate-400 mt-1 italic",children:e.msg})]},t))})]},t))})]})]})]}):null}},3686:()=>{},9280:(e,t,a)=>{Promise.resolve().then(a.bind(a,3175))}},e=>{e.O(0,[524,125,441,255,358],()=>e(e.s=9280)),_N_E=e.O()}]);